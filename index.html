<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tower Ascension RPG</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(to bottom, #1a1a2e, #0f0f1e);
            color: #fff;
            overflow: hidden;
        }
        #game-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        #top-bar {
            background: rgba(0,0,0,0.7);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #4a4a6a;
        }
        #stats-panel {
            display: flex;
            gap: 20px;
            font-size: 14px;
        }
        .stat {
            display: flex;
            flex-direction: column;
        }
        .stat-label {
            color: #888;
            font-size: 11px;
        }
        .stat-value {
            font-weight: bold;
            color: #ffd700;
        }
        #main-content {
            flex: 1;
            display: flex;
            position: relative;
        }
        #game-view {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        #room-display {
            background: rgba(0,0,0,0.5);
            border: 2px solid #4a4a6a;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        #room-title {
            font-size: 24px;
            margin-bottom: 10px;
            color: #ffd700;
        }
        #room-description {
            color: #ccc;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        #combat-area {
            display: none;
            background: rgba(139,0,0,0.3);
            border: 2px solid #ff0000;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        #enemy-info {
            margin-bottom: 15px;
        }
        #enemy-name {
            font-size: 20px;
            color: #ff6b6b;
            margin-bottom: 5px;
        }
        .health-bar {
            background: #333;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        .health-fill {
            background: linear-gradient(to right, #ff0000, #ff6b6b);
            height: 100%;
            transition: width 0.3s;
        }
        .health-fill.player {
            background: linear-gradient(to right, #00ff00, #00aa00);
        }
        #combat-log {
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 5px;
            max-height: 150px;
            overflow-y: auto;
            margin-bottom: 15px;
            font-size: 13px;
        }
        .log-entry {
            margin-bottom: 5px;
            opacity: 0;
            animation: fadeIn 0.3s forwards;
        }
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        .log-damage {
            color: #ff6b6b;
        }
        .log-heal {
            color: #6bff6b;
        }
        .log-info {
            color: #6bb6ff;
        }
        #action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .btn {
            background: linear-gradient(to bottom, #4a4a6a, #2a2a4a);
            border: 2px solid #6a6a8a;
            color: #fff;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
            transition: all 0.2s;
        }
        .btn:hover {
            background: linear-gradient(to bottom, #5a5a7a, #3a3a5a);
            border-color: #7a7a9a;
            transform: translateY(-2px);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .btn-primary {
            background: linear-gradient(to bottom, #4a6a4a, #2a4a2a);
            border-color: #6a8a6a;
        }
        .btn-primary:hover {
            background: linear-gradient(to bottom, #5a7a5a, #3a5a3a);
        }
        .btn-danger {
            background: linear-gradient(to bottom, #6a4a4a, #4a2a2a);
            border-color: #8a6a6a;
        }
        .btn-danger:hover {
            background: linear-gradient(to bottom, #7a5a5a, #5a3a3a);
        }
        #loot-area {
            display: none;
            background: rgba(0,100,0,0.3);
            border: 2px solid #00ff00;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .loot-item {
            background: rgba(0,0,0,0.5);
            border: 2px solid #4a4a6a;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 10px;
        }
        .loot-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .loot-name {
            font-weight: bold;
            font-size: 16px;
        }
        .loot-stats {
            color: #ccc;
            font-size: 13px;
            margin-bottom: 10px;
        }
        #sidebar {
            width: 300px;
            background: rgba(0,0,0,0.7);
            border-left: 2px solid #4a4a6a;
            padding: 20px;
            overflow-y: auto;
        }
        .sidebar-section {
            margin-bottom: 25px;
        }
        .sidebar-title {
            font-size: 18px;
            color: #ffd700;
            margin-bottom: 10px;
            border-bottom: 2px solid #4a4a6a;
            padding-bottom: 5px;
        }
        #class-info {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        #class-name {
            font-size: 20px;
            margin-bottom: 5px;
        }
        #class-progress {
            font-size: 12px;
            color: #888;
            margin-bottom: 10px;
        }
        .progress-bar {
            background: #333;
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        .progress-fill {
            background: linear-gradient(to right, #ffd700, #ffaa00);
            height: 100%;
            transition: width 0.3s;
        }
        .equipment-slot {
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 8px;
            border: 2px solid #4a4a6a;
        }
        .slot-name {
            color: #888;
            font-size: 11px;
            margin-bottom: 3px;
        }
        .slot-item {
            color: #fff;
            font-size: 14px;
        }
        .slot-item.empty {
            color: #555;
            font-style: italic;
        }
        #inventory {
            max-height: 200px;
            overflow-y: auto;
        }
        .inventory-item {
            background: rgba(0,0,0,0.5);
            padding: 8px;
            border-radius: 5px;
            margin-bottom: 5px;
            cursor: pointer;
            border: 2px solid #4a4a6a;
            font-size: 13px;
        }
        .inventory-item:hover {
            background: rgba(50,50,50,0.5);
            border-color: #6a6a8a;
        }
        #pause-menu {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            border: 3px solid #ffd700;
            border-radius: 15px;
            padding: 40px;
            z-index: 1000;
            min-width: 400px;
        }
        #pause-menu h2 {
            text-align: center;
            color: #ffd700;
            margin-bottom: 30px;
            font-size: 32px;
        }
        #pause-menu .btn {
            width: 100%;
            margin-bottom: 15px;
            font-size: 16px;
        }
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        #start-screen h1 {
            font-size: 48px;
            color: #ffd700;
            margin-bottom: 20px;
            text-shadow: 0 0 20px #ffd700;
        }
        #start-screen p {
            color: #ccc;
            margin-bottom: 30px;
            text-align: center;
            max-width: 600px;
            line-height: 1.6;
        }
        #class-selection {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        .class-option {
            background: rgba(0,0,0,0.7);
            border: 2px solid #4a4a6a;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            width: 200px;
        }
        .class-option:hover {
            border-color: #ffd700;
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(255,215,0,0.3);
        }
        .class-option.selected {
            border-color: #ffd700;
            background: rgba(50,50,0,0.3);
        }
        .class-option h3 {
            color: #ffd700;
            margin-bottom: 10px;
            font-size: 20px;
        }
        .class-option p {
            font-size: 13px;
            margin-bottom: 10px;
        }
        .rarity-common { color: #ffffff; }
        .rarity-uncommon { color: #1eff00; }
        .rarity-rare { color: #0070dd; }
        .rarity-epic { color: #a335ee; }
        .rarity-legendary { color: #ff8000; }
        .rarity-hero { color: #ff0000; text-shadow: 0 0 10px #ff0000; }
        .rarity-divine { color: #ffd700; text-shadow: 0 0 15px #ffd700; }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="start-screen">
            <h1>⚔️ TOWER ASCENSION ⚔️</h1>
            <p>Welcome, brave adventurer! Choose your starting class and begin your ascent through the infinite tower. Defeat enemies, collect loot, and grow in power. Your class will evolve based on your achievements!</p>
            <div id="class-selection">
                <div class="class-option" data-class="warrior">
                    <h3>⚔️ Warrior</h3>
                    <p>High HP and Attack. Strong in direct combat.</p>
                    <p><strong>HP:</strong> 120 | <strong>ATK:</strong> 15 | <strong>DEF:</strong> 8</p>
                </div>
                <div class="class-option" data-class="mage">
                    <h3>🔮 Mage</h3>
                    <p>Powerful magic attacks. Lower defense.</p>
                    <p><strong>HP:</strong> 80 | <strong>ATK:</strong> 20 | <strong>DEF:</strong> 5</p>
                </div>
                <div class="class-option" data-class="rogue">
                    <h3>🗡️ Rogue</h3>
                    <p>Balanced stats. Quick and versatile.</p>
                    <p><strong>HP:</strong> 100 | <strong>ATK:</strong> 12 | <strong>DEF:</strong> 7</p>
                </div>
            </div>
            <button class="btn btn-primary" id="start-game-btn" style="font-size: 20px; padding: 15px 40px;" disabled>Begin Your Journey</button>
        </div>

        <div id="top-bar">
            <div id="stats-panel">
                <div class="stat">
                    <span class="stat-label">FLOOR</span>
                    <span class="stat-value" id="floor-display">1</span>
                </div>
                <div class="stat">
                    <span class="stat-label">HP</span>
                    <span class="stat-value" id="hp-display">100/100</span>
                </div>
                <div class="stat">
                    <span class="stat-label">ATTACK</span>
                    <span class="stat-value" id="atk-display">10</span>
                </div>
                <div class="stat">
                    <span class="stat-label">DEFENSE</span>
                    <span class="stat-value" id="def-display">5</span>
                </div>
                <div class="stat">
                    <span class="stat-label">GOLD</span>
                    <span class="stat-value" id="gold-display">0</span>
                </div>
            </div>
            <button class="btn" id="pause-btn">⏸ PAUSE</button>
        </div>

        <div id="main-content">
            <div id="game-view">
                <div id="room-display">
                    <div id="room-title">Floor 1 - Entry Hall</div>
                    <div id="room-description">You stand at the base of the tower. A staircase leads upward into darkness.</div>
                </div>

                <div id="combat-area">
                    <div id="enemy-info">
                        <div id="enemy-name">Enemy Name</div>
                        <div class="health-bar">
                            <div class="health-fill" id="enemy-health-bar" style="width: 100%"></div>
                        </div>
                        <div id="enemy-hp-text">100/100 HP</div>
                    </div>
                    <div id="player-combat-info">
                        <div style="font-size: 16px; margin-bottom: 5px;">You</div>
                        <div class="health-bar">
                            <div class="health-fill player" id="player-health-bar" style="width: 100%"></div>
                        </div>
                        <div id="player-hp-text">100/100 HP</div>
                    </div>
                    <div id="combat-log"></div>
                    <div id="action-buttons">
                        <button class="btn btn-danger" id="attack-btn">⚔️ Attack</button>
                        <button class="btn" id="defend-btn">🛡️ Defend</button>
                        <button class="btn" id="use-potion-btn">🧪 Use Potion</button>
                    </div>
                </div>

                <div id="loot-area">
                    <h3 style="color: #00ff00; margin-bottom: 15px;">💰 Treasure Found!</h3>
                    <div id="loot-items"></div>
                    <button class="btn btn-primary" id="continue-btn">Continue Climbing</button>
                </div>

                <div id="exploration-buttons" style="margin-top: 20px;">
                    <button class="btn btn-primary" id="climb-btn">⬆️ Climb to Next Floor</button>
                </div>
            </div>

            <div id="sidebar">
                <div class="sidebar-section">
                    <div class="sidebar-title">CLASS</div>
                    <div id="class-info">
                        <div id="class-name" class="rarity-common">Warrior</div>
                        <div id="class-progress">Floors until upgrade: 5</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="class-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-title">EQUIPMENT</div>
                    <div class="equipment-slot">
                        <div class="slot-name">WEAPON</div>
                        <div class="slot-item empty" id="weapon-slot">Empty</div>
                    </div>
                    <div class="equipment-slot">
                        <div class="slot-name">ARMOR</div>
                        <div class="slot-item empty" id="armor-slot">Empty</div>
                    </div>
                    <div class="equipment-slot">
                        <div class="slot-name">ACCESSORY</div>
                        <div class="slot-item empty" id="accessory-slot">Empty>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-title">INVENTORY</div>
                    <div id="inventory"></div>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-title">ACHIEVEMENTS</div>
                    <div style="font-size: 12px; color: #ccc;">
                        <div>Enemies Slain: <span id="kills-display">0</span></div>
                        <div>Floors Cleared: <span id="floors-cleared-display">0</span></div>
                        <div>Highest Floor: <span id="highest-floor-display">1</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="pause-menu">
            <h2>⏸ PAUSED</h2>
            <button class="btn btn-primary" id="resume-btn">Resume Game</button>
            <button class="btn" id="stats-btn">View Stats</button>
            <button class="btn btn-danger" id="restart-btn">Restart Game</button>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            paused: false,
            inCombat: false,
            floor: 1,
            floorsCleared: 0,
            highestFloor: 1,
            player: {
                className: 'warrior',
                classRarity: 'common',
                level: 1,
                hp: 100,
                maxHp: 100,
                attack: 10,
                defense: 5,
                gold: 0,
                kills: 0,
                floorsUntilUpgrade: 5,
                equipment: {
                    weapon: null,
                    armor: null,
                    accessory: null
                },
                inventory: []
            },
            currentEnemy: null,
            currentLoot: []
        };

        // Class Templates
        const classTemplates = {
            warrior: { hp: 120, attack: 15, defense: 8 },
            mage: { hp: 80, attack: 20, defense: 5 },
            rogue: { hp: 100, attack: 12, defense: 7 }
        };

        // Rarity multipliers
        const rarityMultipliers = {
            common: 1,
            uncommon: 1.5,
            rare: 2.2,
            epic: 3.5,
            legendary: 5.5,
            hero: 8.5,
            divine: 13
        };

        // Class evolution system
        const classEvolutions = {
            warrior: {
                uncommon: ['Knight', 'Berserker'],
                rare: ['Paladin', 'Dark Knight', 'Warlord'],
                epic: ['Dragon Knight', 'Crusader', 'Doom Bringer'],
                legendary: ['Immortal Warrior', 'God Slayer'],
                hero: ['Titan Champion', 'Eternal Guardian'],
                divine: ['War God', 'Destroyer of Worlds']
            },
            mage: {
                uncommon: ['Elementalist', 'Warlock'],
                rare: ['Archmage', 'Necromancer', 'Battle Mage'],
                epic: ['Storm Caller', 'Void Sage', 'Chronomancer'],
                legendary: ['Arcane Master', 'Reality Bender'],
                hero: ['Cosmic Sorcerer', 'Dimensional Wizard'],
                divine: ['Magic God', 'Universe Weaver']
            },
            rogue: {
                uncommon: ['Assassin', 'Ranger'],
                rare: ['Shadow Blade', 'Master Thief', 'Duelist'],
                epic: ['Phantom', 'Death Stalker', 'Blade Dancer'],
                legendary: ['Shadow Master', 'Void Assassin'],
                hero: ['Eternal Hunter', 'Darkness Incarnate'],
                divine: ['Death God', 'Shadow Sovereign']
            }
        };

        // Room types
        const roomTypes = [
            { type: 'combat', weight: 50, description: 'A dark chamber echoes with hostile presence.' },
            { type: 'combat', weight: 30, description: 'You hear growling in the shadows.' },
            { type: 'treasure', weight: 15, description: 'You spot a glinting chest in the corner.' },
            { type: 'rest', weight: 5, description: 'A peaceful sanctuary offers respite.' }
        ];

        // Enemy templates
        const enemyTypes = [
            { name: 'Goblin', hpMult: 0.8, atkMult: 0.7, gold: 10 },
            { name: 'Skeleton', hpMult: 1, atkMult: 0.8, gold: 15 },
            { name: 'Orc', hpMult: 1.3, atkMult: 1.1, gold: 25 },
            { name: 'Dark Mage', hpMult: 0.9, atkMult: 1.3, gold: 30 },
            { name: 'Troll', hpMult: 1.8, atkMult: 1, gold: 40 },
            { name: 'Demon', hpMult: 1.5, atkMult: 1.5, gold: 60 },
            { name: 'Dragon', hpMult: 2.5, atkMult: 2, gold: 100 }
        ];

        // Item generation
        const itemTypes = {
            weapon: ['Sword', 'Staff', 'Dagger', 'Axe', 'Bow', 'Spear'],
            armor: ['Leather Armor', 'Chain Mail', 'Plate Armor', 'Robes', 'Scale Mail'],
            accessory: ['Ring', 'Amulet', 'Belt', 'Boots', 'Gloves']
        };

        const itemPrefixes = ['', 'Fine ', 'Superior ', 'Masterwork ', 'Enchanted ', 'Legendary ', 'Divine '];

        // Initialize game
        function init() {
            document.querySelectorAll('.class-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.class-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    document.getElementById('start-game-btn').disabled = false;
                });
            });

            document.getElementById('start-game-btn').addEventListener('click', startGame);
            document.getElementById('pause-btn').addEventListener('click', togglePause);
            document.getElementById('resume-btn').addEventListener('click', togglePause);
            document.getElementById('restart-btn').addEventListener('click', () => location.reload());
            document.getElementById('climb-btn').addEventListener('click', climbFloor);
            document.getElementById('attack-btn').addEventListener('click', playerAttack);
            document.getElementById('defend-btn').addEventListener('click', playerDefend);
            document.getElementById('use-potion-btn').addEventListener('click', usePotion);
            document.getElementById('continue-btn').addEventListener('click', () => {
                document.getElementById('loot-area').style.display = 'none';
                document.getElementById('exploration-buttons').style.display = 'block';
            });

            // ESC to pause
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') togglePause();
            });
        }

        function startGame() {
            const selected = document.querySelector('.class-option.selected');
            if (!selected) return;

            const className = selected.dataset.class;
            const template = classTemplates[className];

            gameState.player.className = className;
            gameState.player.hp = template.hp;
            gameState.player.maxHp = template.hp;
            gameState.player.attack = template.attack;
            gameState.player.defense = template.defense;

            document.getElementById('start-screen').style.display = 'none';
            updateUI();
        }

        function togglePause() {
            if (gameState.inCombat) return; // Can't pause during combat
            gameState.paused = !gameState.paused;
            document.getElementById('pause-menu').style.display = gameState.paused ? 'block' : 'none';
        }

        function climbFloor() {
            gameState.floor++;
            gameState.floorsCleared++;
            if (gameState.floor > gameState.highestFloor) {
                gameState.highestFloor = gameState.floor;
            }

            // Check for class upgrade
            gameState.player.floorsUntilUpgrade--;
            if (gameState.player.floorsUntilUpgrade <= 0) {
                upgradeClass();
            }

            // Generate room
            const room = generateRoom();
            displayRoom(room);
            updateUI();
        }

        function generateRoom() {
            const totalWeight = roomTypes.reduce((sum, r) => sum + r.weight, 0);
            let random = Math.random() * totalWeight;
            
            for (const room of roomTypes) {
                random -= room.weight;
                if (random <= 0) {
                    return { ...room };
                }
            }
            return roomTypes[0];
        }

        function displayRoom(room) {
            document.getElementById('room-title').textContent = `Floor ${gameState.floor} - ${getRoomTitle(room.type)}`;
            document.getElementById('room-description').textContent = room.description;
            
            if (room.type === 'combat') {
                startCombat();
            } else if (room.type === 'treasure') {
                showTreasure();
            } else if (room.type === 'rest') {
                restRoom();
            }
        }

        function getRoomTitle(type) {
            const titles = {
                combat: ['Battle Chamber', 'Monster Den', 'Dark Arena', 'Cursed Hall'],
                treasure: ['Treasure Room', 'Vault', 'Hoard'],
                rest: ['Safe Haven', 'Sanctuary', 'Shrine']
            };
            return titles[type][Math.floor(Math.random() * titles[type].length)];
        }

        function startCombat() {
            gameState.inCombat = true;
            gameState.currentEnemy = generateEnemy();
            
            document.getElementById('exploration-buttons').style.display = 'none';
            document.getElementById('combat-area').style.display = 'block';
            document.getElementById('combat-log').innerHTML = '';
            
            updateCombatUI();
            addCombatLog(`A ${gameState.currentEnemy.name} appears!`, 'info');
        }

        function generateEnemy() {
            const floorMultiplier = 1 + (gameState.floor * 0.15);
            const template = enemyTypes[Math.min(Math.floor(gameState.floor / 5), enemyTypes.length - 1)];
            
            return {
                name: template.name,
                maxHp: Math.floor(50 * template.hpMult * floorMultiplier),
                hp: Math.floor(50 * template.hpMult * floorMultiplier),
                attack: Math.floor(8 * template.atkMult * floorMultiplier),
                gold: Math.floor(template.gold * (1 + gameState.floor * 0.1))
            };
        }

        function playerAttack() {
            if (!gameState.inCombat) return;
            
            const damage = Math.max(1, gameState.player.attack - Math.floor(gameState.currentEnemy.attack * 0.1));
            gameState.currentEnemy.hp -= damage;
            addCombatLog(`You deal ${damage} damage!`, 'damage');
            
            if (gameState.currentEnemy.hp <= 0) {
                winCombat();
                return;
            }
            
            updateCombatUI();
            setTimeout(enemyAttack, 800);
        }

        function playerDefend() {
            if (!gameState.inCombat) return;
            
            addCombatLog('You brace for impact!', 'info');
            gameState.player.defending = true;
            
            setTimeout(enemyAttack, 800);
        }

        function usePotion() {
            const potion = gameState.player.inventory.find(item => item.type === 'potion');
            if (!potion) {
                addCombatLog('No potions available!', 'info');
                return;
            }
            
            const healAmount = Math.floor(gameState.player.maxHp * 0.4);
            gameState.player.hp = Math.min(gameState.player.maxHp, gameState.player.hp + healAmount);
            gameState.player.inventory = gameState.player.inventory.filter(item => item !== potion);
            
            addCombatLog(`You heal ${healAmount} HP!`, 'heal');
            updateUI();
            updateInventoryUI();
            
            setTimeout(enemyAttack, 800);
        }

        function enemyAttack() {
            if (!gameState.inCombat) return;
            
            let damage = Math.max(1, gameState.currentEnemy.attack - gameState.player.defense);
            
            if (gameState.player.defending) {
                damage = Math.floor(damage * 0.5);
                gameState.player.defending = false;
                addCombatLog(`Enemy attacks! You block and take ${damage} damage!`, 'damage');
            } else {
                addCombatLog(`Enemy attacks for ${damage} damage!`, 'damage');
            }
            
            gameState.player.hp -= damage;
            
            if (gameState.player.hp <= 0) {
                gameOver();
                return;
            }
            
            updateCombatUI();
        }

        function winCombat() {
            gameState.inCombat = false;
            gameState.player.kills++;
            gameState.player.gold += gameState.currentEnemy.gold;
            
            addCombatLog(`Victory! You earned ${gameState.currentEnemy.gold} gold!`, 'heal');
            
            setTimeout(() => {
                document.getElementById('combat-area').style.display = 'none';
                showTreasure();
            }, 1500);
        }

        function showTreasure() {
            const loot = generateLoot();
            gameState.currentLoot = loot;
            
            const lootContainer = document.getElementById('loot-items');
            lootContainer.innerHTML = '';
            
            loot.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'loot-item';
                itemDiv.style.borderColor = getRarityColor(item.rarity);
                
                itemDiv.innerHTML = `
                    <div class="loot-header">
                        <div class="loot-name rarity-${item.rarity}">${item.name}</div>
                        <div style="color: #ffd700;">${item.slot.toUpperCase()}</div>
                    </div>
                    <div class="loot-stats">
                        ${item.attack ? `+${item.attack} Attack` : ''}
                        ${item.defense ? `+${item.defense} Defense` : ''}
                        ${item.hp ? `+${item.hp} Max HP` : ''}
                    </div>
                    <button class="btn btn-primary" onclick="equipItem(${index})">Equip</button>
                    <button class="btn" onclick="storeItem(${index})">Store in Inventory</button>
                `;
                
                lootContainer.appendChild(itemDiv);
            });
            
            // Add gold and potions
            const goldAmount = Math.floor(20 + gameState.floor * 5);
            gameState.player.gold += goldAmount;
            
            if (Math.random() < 0.3) {
                gameState.player.inventory.push({ name: 'Health Potion', type: 'potion' });
                const potionDiv = document.createElement('div');
                potionDiv.className = 'loot-item';
                potionDiv.innerHTML = `
                    <div class="loot-name" style="color: #ff69b4;">🧪 Health Potion</div>
                    <div class="loot-stats">Restores 40% HP</div>
                `;
                lootContainer.appendChild(potionDiv);
            }
            
            const goldDiv = document.createElement('div');
            goldDiv.className = 'loot-item';
            goldDiv.innerHTML = `<div class="loot-name" style="color: #ffd700;">💰 ${goldAmount} Gold</div>`;
            lootContainer.appendChild(goldDiv);
            
            document.getElementById('loot-area').style.display = 'block';
            document.getElementById('exploration-buttons').style.display = 'none';
            updateUI();
            updateInventoryUI();
        }

        function generateLoot() {
            const items = [];
            const numItems = Math.random() < 0.7 ? 1 : 2;
            
            for (let i = 0; i < numItems; i++) {
                const slots = ['weapon', 'armor', 'accessory'];
                const slot = slots[Math.floor(Math.random() * slots.length)];
                const itemBase = itemTypes[slot][Math.floor(Math.random() * itemTypes[slot].length)];
                
                const rarityRoll = Math.random();
                let rarity = 'common';
                let rarityLevel = 0;
                
                if (rarityRoll < 0.4) rarity = 'common';
                else if (rarityRoll < 0.65) { rarity = 'uncommon'; rarityLevel = 1; }
                else if (rarityRoll < 0.82) { rarity = 'rare'; rarityLevel = 2; }
                else if (rarityRoll < 0.92) { rarity = 'epic'; rarityLevel = 3; }
                else if (rarityRoll < 0.97) { rarity = 'legendary'; rarityLevel = 4; }
                else if (rarityRoll < 0.995) { rarity = 'hero'; rarityLevel = 5; }
                else { rarity = 'divine'; rarityLevel = 6; }
                
                const prefix = itemPrefixes[Math.min(rarityLevel, itemPrefixes.length - 1)];
                const multiplier = rarityMultipliers[rarity];
                const floorBonus = 1 + (gameState.floor * 0.1);
                
                const item = {
                    name: prefix + itemBase,
                    slot: slot,
                    rarity: rarity,
                    attack: slot === 'weapon' ? Math.floor(5 * multiplier * floorBonus) : 0,
                    defense: slot === 'armor' ? Math.floor(3 * multiplier * floorBonus) : 0,
                    hp: slot === 'accessory' ? Math.floor(10 * multiplier * floorBonus) : 0
                };
                
                items.push(item);
            }
            
            return items;
        }

        function equipItem(index) {
            const item = gameState.currentLoot[index];
            const slot = item.slot;
            
            // Unequip old item
            if (gameState.player.equipment[slot]) {
                const oldItem = gameState.player.equipment[slot];
                gameState.player.attack -= oldItem.attack || 0;
                gameState.player.defense -= oldItem.defense || 0;
                gameState.player.maxHp -= oldItem.hp || 0;
                gameState.player.hp = Math.min(gameState.player.hp, gameState.player.maxHp);
            }
            
            // Equip new item
            gameState.player.equipment[slot] = item;
            gameState.player.attack += item.attack || 0;
            gameState.player.defense += item.defense || 0;
            gameState.player.maxHp += item.hp || 0;
            gameState.player.hp += item.hp || 0;
            
            gameState.currentLoot.splice(index, 1);
            
            // Refresh loot display
            if (gameState.currentLoot.length === 0) {
                document.getElementById('loot-area').style.display = 'none';
                document.getElementById('exploration-buttons').style.display = 'block';
            } else {
                showTreasure();
            }
            
            updateUI();
            updateEquipmentUI();
        }

        function storeItem(index) {
            const item = gameState.currentLoot[index];
            gameState.player.inventory.push(item);
            gameState.currentLoot.splice(index, 1);
            
            if (gameState.currentLoot.length === 0) {
                document.getElementById('loot-area').style.display = 'none';
                document.getElementById('exploration-buttons').style.display = 'block';
            } else {
                showTreasure();
            }
            
            updateInventoryUI();
        }

        function restRoom() {
            const healAmount = Math.floor(gameState.player.maxHp * 0.5);
            gameState.player.hp = Math.min(gameState.player.maxHp, gameState.player.hp + healAmount);
            
            document.getElementById('room-description').textContent += ` You rest and recover ${healAmount} HP.`;
            document.getElementById('exploration-buttons').style.display = 'block';
            updateUI();
        }

        function upgradeClass() {
            const currentRarity = gameState.player.classRarity;
            const rarities = ['common', 'uncommon', 'rare', 'epic', 'legendary', 'hero', 'divine'];
            const currentIndex = rarities.indexOf(currentRarity);
            
            if (currentIndex >= rarities.length - 1) {
                gameState.player.floorsUntilUpgrade = 10;
                return;
            }
            
            const nextRarity = rarities[currentIndex + 1];
            const baseClass = gameState.player.className.toLowerCase();
            
            // Determine new class based on performance
            let evolutionPool = classEvolutions[baseClass][nextRarity];
            if (!evolutionPool) evolutionPool = [gameState.player.className];
            
            const newClassName = evolutionPool[Math.floor(Math.random() * evolutionPool.length)];
            const multiplier = rarityMultipliers[nextRarity];
            const prevMultiplier = rarityMultipliers[currentRarity];
            const growthFactor = multiplier / prevMultiplier;
            
            gameState.player.classRarity = nextRarity;
            gameState.player.className = newClassName;
            
            // Upgrade stats
            gameState.player.maxHp = Math.floor(gameState.player.maxHp * growthFactor);
            gameState.player.hp = gameState.player.maxHp;
            gameState.player.attack = Math.floor(gameState.player.attack * growthFactor);
            gameState.player.defense = Math.floor(gameState.player.defense * growthFactor);
            
            // Set next upgrade requirement
            gameState.player.floorsUntilUpgrade = 5 + (currentIndex + 1) * 3;
            
            // Show upgrade notification
            alert(`🎉 CLASS UPGRADE! 🎉\n\nYou have evolved into a ${nextRarity.toUpperCase()} class:\n${newClassName}\n\nYour power has greatly increased!`);
            
            updateUI();
        }

        function gameOver() {
            gameState.inCombat = false;
            alert(`💀 GAME OVER 💀\n\nYou were defeated on Floor ${gameState.floor}\n\nStats:\n- Highest Floor: ${gameState.highestFloor}\n- Enemies Slain: ${gameState.player.kills}\n- Gold Earned: ${gameState.player.gold}\n- Final Class: ${gameState.player.className} (${gameState.player.classRarity})`);
            location.reload();
        }

        function updateUI() {
            document.getElementById('floor-display').textContent = gameState.floor;
            document.getElementById('hp-display').textContent = `${gameState.player.hp}/${gameState.player.maxHp}`;
            document.getElementById('atk-display').textContent = gameState.player.attack;
            document.getElementById('def-display').textContent = gameState.player.defense;
            document.getElementById('gold-display').textContent = gameState.player.gold;
            
            document.getElementById('class-name').textContent = gameState.player.className;
            document.getElementById('class-name').className = `rarity-${gameState.player.classRarity}`;
            document.getElementById('class-progress').textContent = `Floors until upgrade: ${gameState.player.floorsUntilUpgrade}`;
            
            const progressPercent = 100 - (gameState.player.floorsUntilUpgrade / (5 + rarities.indexOf(gameState.player.classRarity) * 3)) * 100;
            document.getElementById('class-progress-bar').style.width = Math.max(0, progressPercent) + '%';
            
            document.getElementById('kills-display').textContent = gameState.player.kills;
            document.getElementById('floors-cleared-display').textContent = gameState.floorsCleared;
            document.getElementById('highest-floor-display').textContent = gameState.highestFloor;
            
            updateEquipmentUI();
        }

        function updateCombatUI() {
            if (!gameState.currentEnemy) return;
            
            document.getElementById('enemy-name').textContent = gameState.currentEnemy.name;
            document.getElementById('enemy-hp-text').textContent = `${gameState.currentEnemy.hp}/${gameState.currentEnemy.maxHp} HP`;
            const enemyHealthPercent = (gameState.currentEnemy.hp / gameState.currentEnemy.maxHp) * 100;
            document.getElementById('enemy-health-bar').style.width = enemyHealthPercent + '%';
            
            document.getElementById('player-hp-text').textContent = `${gameState.player.hp}/${gameState.player.maxHp} HP`;
            const playerHealthPercent = (gameState.player.hp / gameState.player.maxHp) * 100;
            document.getElementById('player-health-bar').style.width = playerHealthPercent + '%';
        }

        function updateEquipmentUI() {
            const weapon = gameState.player.equipment.weapon;
            const armor = gameState.player.equipment.armor;
            const accessory = gameState.player.equipment.accessory;
            
            const weaponSlot = document.getElementById('weapon-slot');
            weaponSlot.textContent = weapon ? weapon.name : 'Empty';
            weaponSlot.className = weapon ? `slot-item rarity-${weapon.rarity}` : 'slot-item empty';
            
            const armorSlot = document.getElementById('armor-slot');
            armorSlot.textContent = armor ? armor.name : 'Empty';
            armorSlot.className = armor ? `slot-item rarity-${armor.rarity}` : 'slot-item empty';
            
            const accessorySlot = document.getElementById('accessory-slot');
            accessorySlot.textContent = accessory ? accessory.name : 'Empty';
            accessorySlot.className = accessory ? `slot-item rarity-${accessory.rarity}` : 'slot-item empty';
        }

        function updateInventoryUI() {
            const inventoryDiv = document.getElementById('inventory');
            inventoryDiv.innerHTML = '';
            
            if (gameState.player.inventory.length === 0) {
                inventoryDiv.innerHTML = '<div style="color: #555; font-style: italic; font-size: 12px;">Empty</div>';
                return;
            }
            
            gameState.player.inventory.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'inventory-item';
                
                if (item.type === 'potion') {
                    itemDiv.textContent = `🧪 ${item.name}`;
                } else {
                    itemDiv.className += ` rarity-${item.rarity}`;
                    itemDiv.textContent = item.name;
                    itemDiv.onclick = () => {
                        if (confirm(`Equip ${item.name}?`)) {
                            equipFromInventory(index);
                        }
                    };
                }
                
                inventoryDiv.appendChild(itemDiv);
            });
        }

        function equipFromInventory(index) {
            const item = gameState.player.inventory[index];
            if (item.type === 'potion') return;
            
            const slot = item.slot;
            
            if (gameState.player.equipment[slot]) {
                gameState.player.inventory.push(gameState.player.equipment[slot]);
            }
            
            if (gameState.player.equipment[slot]) {
                const oldItem = gameState.player.equipment[slot];
                gameState.player.attack -= oldItem.attack || 0;
                gameState.player.defense -= oldItem.defense || 0;
                gameState.player.maxHp -= oldItem.hp || 0;
                gameState.player.hp = Math.min(gameState.player.hp, gameState.player.maxHp);
            }
            
            gameState.player.equipment[slot] = item;
            gameState.player.attack += item.attack || 0;
            gameState.player.defense += item.defense || 0;
            gameState.player.maxHp += item.hp || 0;
            gameState.player.hp += item.hp || 0;
            
            gameState.player.inventory.splice(index, 1);
            
            updateUI();
            updateInventoryUI();
        }

        function addCombatLog(message, type) {
            const logDiv = document.getElementById('combat-log');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = message;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            
            if (logDiv.children.length > 10) {
                logDiv.removeChild(logDiv.firstChild);
            }
        }

        function getRarityColor(rarity) {
            const colors = {
                common: '#ffffff',
                uncommon: '#1eff00',
                rare: '#0070dd',
                epic: '#a335ee',
                legendary: '#ff8000',
                hero: '#ff0000',
                divine: '#ffd700'
            };
            return colors[rarity] || '#ffffff';
        }

        const rarities = ['common', 'uncommon', 'rare', 'epic', 'legendary', 'hero', 'divine'];

        // Start the game
        init();
    </script>
</body>
</html>
